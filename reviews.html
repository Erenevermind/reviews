<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Review Form</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>

* {
    cursor: url('mashumaro.neocities.org/assets/nyan.png'), default;
}


a:hover {
    cursor: url('mashumaro.neocities.org/assets/click.png'), pointer;
}


button:hover {
    cursor: url('mashumaro.neocities.org/assets/click.png'), pointer;
}

    body {
        font-family: 'Poppins';
        padding: 20px;
        margin: 0;
        background: transparent;
    }

    .form-container {
        background: white;
        border-radius: 10px;
        padding: 20px;
        margin: 0 auto;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .form-container h2 {
        text-align: center;
        font-size: 24px;
        margin-bottom: 20px;
    }

    .form-group {
        margin-bottom: 15px;
    }

    .form-group label {
        font-size: 16px;
        display: block;
        margin-bottom: 7px;
    }

    .profile-pic-nickname {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
    }

    .profile-pic {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background-image: url('mashumaro.neocities.org/pfp/default.jpg');
        background-size: cover;
        background-position: center;
        flex-shrink: 0;
        border: 2px solid #ddd;
    }

    .nickname-input {
        padding: 10px;
        border-radius: 6px;
        border: 1px solid #ddd;
        font-size: 14px;
        font-family: 'Poppins';
        min-width: 120px;
        box-sizing: border-box;
    }

    .choose-pfp-btn {
        padding: 8px 15px;
        font-family: 'Poppins';
        background-color: #c7eaff;
        color: black;
        border-radius: 6px;
        font-size: 14px;
        border: none;
    }
    
    .choose-pfp-btn:hover {
        background-color: #a6ccff;
    }

    .review-input {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-family: 'Poppins';
        font-size: 14px;
        resize: vertical;
        box-sizing: border-box;
        min-height: 80px;
    }

    .pfp-options {
        display: none;
        margin-top: 10px;
        gap: 10px;
        flex-wrap: wrap;
    }

    .pfp-options img {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        border: 2px solid transparent;
        transition: border 0.2s;
    }

    .pfp-options img.selected {
        border-color: #c7eaff;
    }

    .rating {
        display: flex;
        flex-direction: row;
        gap: 10px;
        align-items: center;
    }

    .rating label {
        font-size: 32px;
        color: #ccc;
        transition: color 0.2s;
        border-radius: 50%;
        padding: 0;
        line-height: 1;
    }

    .rating input {
        display: none;
    }

    .rating label.hovered,
    .rating label.selected {
        color: #ffcc00;
    }

    .submit-btn {
        background-color: #c7eaff;
        color: black;
        padding: 7px 17px;
        border: none;
        border-radius: 20px;
        font-weight: bold;
        font-family: 'Poppins';
        width: 100%;
        margin-top: 20px;
    }

    .submit-btn:hover {
        background-color: #a6ccff;
    }

    .error-message {
        color: red;
        font-size: 14px;
        margin-top: 10px;
    }

    #past-reviews-container {
        margin-top: 20px;
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .review-box {
        background-color: #ffffff;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        padding: 15px;
        border-radius: 8px;
        display: flex;
        gap: 10px;
        align-items: flex-start;
    }

    .review-pfp-small {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background-size: cover;
        background-position: center;
        flex-shrink: 0;
        border: 1px solid #ddd;
    }

    .review-details {
        flex-grow: 1;
    }

    .review-nickname {
        font-weight: bold;
        margin-bottom: 2px;
    }

    .review-date {
        font-size: 0.8em;
        color: #777;
    }

    .review-rating {
        color: #ffcc00;
        font-size: 1.1em;
        margin-bottom: 5px;
    }

    .review-comment-text {
        font-size: 1em;
        color: #333;
    }

    #past-reviews-column {
        flex: 25%;
        min-width: 150px;
        padding-left: 20px;
    }

    #past-reviews-column h2 {
        font-size: 20px;
        margin-bottom: 10px;
        text-align: left;
    }

    body > div {
        display: flex;
        gap: 20px;
        padding: 20px;
        align-items: flex-start;
    }

    body > div > div:first-child {
        flex: 75%;
        max-width: 700px;
    }

@media (max-width: 768px) {
    body > div {
        flex-direction: column; 
    }

    body > div > div:first-child {
        width: 100%; 
        max-width: none;
        margin-bottom: 20px;
    }

    #past-reviews-column {
        width: 100%;
        padding-left: 0;
    }

    #past-reviews-column h2 {
        text-align: center;
    }

    .form-container {
        padding: 15px;
    }

    .form-container h2 {
        font-size: 20px;
        margin-bottom: 15px;
    }

    .form-group {
        margin-bottom: 10px;
    }

    .profile-pic-nickname {
        flex-direction: column;
        align-items: flex-start;
    }

    .nickname-input {
        width: 100%;
        margin-top: 10px;
    }

    .pfp-options {
        flex-direction: row;
        justify-content: flex-start;
    }

    .rating {
        justify-content: center;
    }

    .submit-btn {
        padding: 10px 20px;
        margin-top: 15px;
    }

    #past-reviews-container {
        margin-top: 15px;
    }

    .review-box {
        flex-direction: column;
        align-items: flex-start;
        padding: 10px;
    }

    .review-pfp-small {
        margin-bottom: 5px;
    }
}
</style>
</head>
<body>
  <div style="display: flex; gap: 20px; padding: 20px; align-items: flex-start;">
    <div style="flex: 75%; max-width: 700px;">
      <div class="form-container">
        <h2>Leave a Review</h2>
        <form id="review-form">
          <div class="form-group">
            <label for="nickname">Choose PFP & Enter Nickname</label>
            <div class="profile-pic-nickname">
              <div class="profile-pic" id="profile-pic-display"></div>
              <button type="button" class="choose-pfp-btn" onclick="togglePfpOptions()">Choose PFP</button>
              <input type="text" name="nickname" class="nickname-input" placeholder="Your Nickname">
            </div>
            <div class="pfp-options" id="pfp-options">
              <img src="mashumaro.neocities.org/pfp/default.jpg" onclick="selectPfp(this)">
              <img src="mashumaro.neocities.org/pfp/default2.png" onclick="selectPfp(this)">
              <img src="mashumaro.neocities.org/pfp/default3.png" onclick="selectPfp(this)">
              <img src="mashumaro.neocities.org/pfp/default4.png" onclick="selectPfp(this)">
              <img src="mashumaro.neocities.org/pfp/default5.png" onclick="selectPfp(this)">
              <img src="mashumaro.neocities.org/pfp/default6.png" onclick="selectPfp(this)">
              <img src="mashumaro.neocities.org/pfp/default7.png" onclick="selectPfp(this)">
              <img src="mashumaro.neocities.org/pfp/default8.png" onclick="selectPfp(this)">
              <img src="mashumaro.neocities.org/pfp/default9.png" onclick="selectPfp(this)">
            </div>
            <input type="hidden" name="profile-pic-url" id="selected-pfp-url">
          </div>

          <div class="form-group">
            <label for="rating">Rate the artist! (out of 5)</label>
            <div class="rating" id="star-rating">
              <input type="radio" id="star1" name="rating" value="1"><label for="star1" data-value="1">★</label>
              <input type="radio" id="star2" name="rating" value="2"><label for="star2" data-value="2">★</label>
              <input type="radio" id="star3" name="rating" value="3"><label for="star3" data-value="3">★</label>
              <input type="radio" id="star4" name="rating" value="4"><label for="star4" data-value="4">★</label>
              <input type="radio" id="star5" name="rating" value="5"><label for="star5" data-value="5">★</label>
            </div>
          </div>

          <div class="form-group">
            <label for="review-comment">Your Review (Optional)</label>
            <textarea id="review-comment" name="review-comment" class="review-input" placeholder="Write your review here..."></textarea>
          </div>

          <button type="submit" class="submit-btn">Submit Review</button>
          <div id="error-message" class="error-message"></div>
        </form>
      </div>
    </div>
    <div id="past-reviews-column" style="flex: 25%; min-width: 150px; padding-left: 20px;">
      <h2>Past Reviews</h2>
      <div id="past-reviews-container">
        </div>
    </div>
  </div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('selected-pfp-url').value = '/pfp/default.jpg';
    document.getElementById('profile-pic-display').style.backgroundImage = "url('/pfp/default.jpg')";
  });

  function togglePfpOptions() {
    const options = document.getElementById("pfp-options");
    options.style.display = options.style.display === "flex" ? "none" : "flex";
  }

  function selectPfp(img) {
    document.querySelectorAll(".pfp-options img").forEach(p => p.classList.remove("selected"));
    img.classList.add("selected");
    document.getElementById("profile-pic-display").style.backgroundImage = `url('${img.src}')`;
    document.getElementById("selected-pfp-url").value = img.src;
    document.getElementById("pfp-options").style.display = "none";
  }

  const starLabels = document.querySelectorAll('#star-rating label');
  const starInputs = document.querySelectorAll('#star-rating input');
  let selectedRating = 0;

  function highlightStars(val) {
    starLabels.forEach(label => {
      const labelValue = parseInt(label.dataset.value);
      label.classList.toggle('selected', labelValue <= val);
    });
  }

  starLabels.forEach(label => {
    label.addEventListener('mouseenter', () => {
      const val = parseInt(label.dataset.value);
      highlightStars(val);
    });
    label.addEventListener('mouseleave', () => {
      highlightStars(selectedRating);
    });
    label.addEventListener('click', () => {
      const clickedValue = parseInt(label.dataset.value);
      selectedRating = clickedValue === selectedRating ? 0 : clickedValue;
      highlightStars(selectedRating);
      starInputs.forEach(input => {
        input.checked = parseInt(input.value) === selectedRating;
      });
    });
  });

  document.getElementById('review-form').addEventListener('submit', function(event) {
    event.preventDefault();

    const rating = selectedRating;
    const comment = document.getElementById('review-comment').value.trim();
    const nickname = document.querySelector('.nickname-input').value.trim();
    const pfp = document.getElementById('selected-pfp-url').value.trim();
    const errorEl = document.getElementById('error-message');

    if (!rating || !nickname) {
      errorEl.textContent = "Please complete all fields!";
      return;
    }

    errorEl.textContent = "";

    fetch("https://script.google.com/macros/s/AKfycbza_WoJgrOjRF3TH-P8r-t46FbQDrzpHqyqnTJaiR6vU5OSsEJgRTDlRkkoHmhAEhbs/exec", {
      method: "POST",
      body: new FormData(document.getElementById('review-form'))
    })
    .then(response => response.text())
    .then(result => {
      if (result.trim() === "Success") {
        alert("Thank you for your review! (♡ˊ͈ ꒳ ˋ͈)");
        document.getElementById('review-form').reset();
        selectedRating = 0;
        highlightStars(0);
        document.getElementById("profile-pic-display").style.backgroundImage = "url('/pfp/default.jpg')";
        loadPastReviews();
      } else {
        alert("Thank you for your review! (♡ˊ͈ ꒳ ˋ͈)");
        document.getElementById('review-form').reset();
        selectedRating = 0;
        highlightStars(0);
        document.getElementById("profile-pic-display").style.backgroundImage = "url('/pfp/default.jpg')";
        loadPastReviews();
      }
    })
    .catch(() => {
      alert("Thank you for your review! (♡ˊ͈ ꒳ ˋ͈)");
      document.getElementById('review-form').reset();
      selectedRating = 0;
      highlightStars(0);
      document.getElementById("profile-pic-display").style.backgroundImage = "url('/pfp/default.jpg')";
      loadPastReviews();
    });
  });

    function loadPastReviews() {
    const spreadsheetId = "1RgCj_kHxkcCsGvqPVYmSLzcAgSHmP5LlEKg3z1Q5JiM";
    const apiKey = "AIzaSyD6TC5zeDxhp5-CzQBMfNqqXsL8z4Tw9OM";
    const range = "Reviews";

    const apiUrl = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}?alt=json&key=${apiKey}`;

    fetch(apiUrl)
      .then(response => response.json())
      .then(data => {
        const reviewsContainer = document.getElementById('past-reviews-container');
        reviewsContainer.innerHTML = '';

        if (data.values && data.values.length > 1) {
          const headers = data.values[0];
          const reviewsData = data.values.slice(1);

          reviewsData.forEach(row => {

            const reviewBox = document.createElement('div');
            reviewBox.classList.add('review-box');

            const pfpUrl = row[4] || '/pfp/default.jpg';
            const pfpDiv = document.createElement('div');
            pfpDiv.classList.add('review-pfp-small');
            pfpDiv.style.backgroundImage = `url('${pfpUrl}')`;

            const detailsDiv = document.createElement('div');
            detailsDiv.classList.add('review-details');

            const nicknamePara = document.createElement('p');
            nicknamePara.classList.add('review-nickname');
            nicknamePara.textContent = row[1];

            const date = new Date(row[0]);
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = String(date.getFullYear()).slice(-2);
            const formattedDate = `${day}/${month}/${year}`;
            const dateSpan = document.createElement('span');
            dateSpan.classList.add('review-date');
            dateSpan.textContent = ` (${formattedDate})`;

            nicknamePara.appendChild(dateSpan);

            let stars = '';
            for (let i = 0; i < parseInt(row[2]); i++) {
              stars += '★';
            }
            const ratingPara = document.createElement('p');
            ratingPara.classList.add('review-rating');
            ratingPara.textContent = stars;

            const commentPara = document.createElement('p');
            commentPara.classList.add('review-comment-text');
            commentPara.textContent = row[3];

            detailsDiv.appendChild(nicknamePara);
            detailsDiv.appendChild(ratingPara);
            detailsDiv.appendChild(commentPara);

            reviewBox.appendChild(pfpDiv);
            reviewBox.appendChild(detailsDiv);

            reviewsContainer.appendChild(reviewBox);
          });
        } else {
          reviewsContainer.textContent = "No past reviews available.";
        }
      })
      .catch(error => {
        console.error("Error loading past reviews:", error);
        const reviewsContainer = document.getElementById('past-reviews-container');
        reviewsContainer.textContent = "Failed to load past reviews.";
      });
  }

  window.onload = loadPastReviews;
</script>
</body>
</html>
